<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle Skirt Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f0f2f5;
            color: #333;
            padding: 12px;
            min-height: 100vh;
        }
        
        .calculator-container {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 12px;
            align-items: stretch;
        }
        
        .input-section, .visual-section {
            background: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            height: auto;
            display: flex;
            flex-direction: column;
        }
        
        .visual-section {
            align-items: center;
            justify-content: flex-start;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 14px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            width: 100%;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 8px;
        }
        
        label {
            display: block;
            margin-bottom: 2px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 11px;
        }
        
        .input-with-slider {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .number-input {
            width: 100%;
            padding: 3px 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            height: 24px;
        }
        
        .number-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        
        .slider-value {
            min-width: 28px;
            font-size: 10px;
            color: #666;
            text-align: right;
        }
        
        .range-slider {
            flex: 1;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 2px;
            outline: none;
            margin: 0;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .range-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .skirt-type-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }
        
        .skirt-type-btn {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 3px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            font-weight: 500;
        }
        
        .skirt-type-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .canvas-container {
            width: 100%;
            height: auto;
            flex-grow: 1;
            min-height: 600px;
            position: relative;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        canvas {
            width: 100%;
            height: 100%;
        }
        
        .panel-controls {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            width: 100%;
        }
        
        .panel-btn {
            flex: 1;
            padding: 8px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .panel-btn:hover {
            background: #2980b9;
        }
        
        .results-box {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 12px;
            margin: 12px 0;
        }
        
        .result-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .result-value {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
        }
        
        .reset-btn {
            background: #95a5a6;
            color: white;
        }
        
        .reset-btn:hover {
            background: #7f8c8d;
        }
        
        .preview-btn {
            background: #2ecc71;
            color: white;
        }
        
        .preview-btn:hover {
            background: #27ae60;
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .canvas-container {
                min-height: 450px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="visual-section">
            <h2>Pattern Preview (Click a panel to split it specifically)</h2>
            <div class="canvas-container">
                <canvas id="skirtCanvas"></canvas>
            </div>
            <div class="panel-controls">
                <button class="panel-btn" id="splitAll">Split All Evenly</button>
                <button class="panel-btn" id="mergeAll">Merge All</button>
                <button class="panel-btn" id="resetPanels">Reset Panels</button>
            </div>
        </div>
        
        <div class="input-section">
            <h2>Skirt Settings</h2>
            <div class="skirt-type-container">
                <div class="skirt-type-btn active" data-type="full">Full Circle</div>
                <div class="skirt-type-btn" data-type="three-quarter">3/4 Circle</div>
                <div class="skirt-type-btn" data-type="half">Half Circle</div>
                <div class="skirt-type-btn" data-type="third">1/3 Circle</div>
                <div class="skirt-type-btn" data-type="quarter">1/4 Circle</div>
            </div>
            
            <div class="form-row">
                <div>
                    <div class="form-group">
                        <label>Total Seams:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="seams" value="12" min="1" max="16" step="1">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="seamsSlider" min="1" max="16" step="1" value="12">
                                <span class="slider-value" id="seamsValue">12</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Side Seam:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="sideSeam" value="0.375" min="0" max="2" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="sideSeamSlider" min="0" max="2" step="0.125" value="0.375">
                                <span class="slider-value" id="sideSeamValue">0.375</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Length:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="length" value="22" min="5" max="60" step="0.5">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="lengthSlider" min="5" max="60" step="0.5" value="22">
                                <span class="slider-value" id="lengthValue">22</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="form-group">
                        <label>Waist Circ.:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="waist" value="38.5" min="20" max="60" step="0.5">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="waistSlider" min="20" max="60" step="0.5" value="38.5">
                                <span class="slider-value" id="waistValue">38.5</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Waist Seam:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="waistSeam" value="0.375" min="0" max="2" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="waistSeamSlider" min="0" max="2" step="0.125" value="0.375">
                                <span class="slider-value" id="waistSeamValue">0.375</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Hem Allowance:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="hem" value="1.5" min="0" max="3" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="hemSlider" min="0" max="3" step="0.125" value="1.5">
                                <span class="slider-value" id="hemValue">1.5</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2>Results</h2>
            <div class="results-box">
                <div class="result-item">
                    <div class="result-label">Waist Radius</div>
                    <div class="result-value" id="waistRadius">6.25"</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Total Radius</div>
                    <div class="result-value" id="totalRadius">29.75"</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Total Waist Arc</div>
                    <div class="result-value" id="waistArc">43.75"</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn reset-btn" id="resetBtn">RESET</button>
                <button class="action-btn preview-btn" id="previewBtn">PREVIEW / PRINT</button>
            </div>
        </div>
    </div>

    <script>
        class CircleSkirtCalculator {
            constructor() {
                this.initElements();
                this.initCanvas();
                this.bindEvents();
                this.setupSliders();
                this.calculate();
            }
            
            initElements() {
                this.skirtTypeBtns = document.querySelectorAll('.skirt-type-btn');
                this.skirtType = 'full';
                
                this.seamsInput = document.getElementById('seams');
                this.sideSeamInput = document.getElementById('sideSeam');
                this.lengthInput = document.getElementById('length');
                this.waistInput = document.getElementById('waist');
                this.waistSeamInput = document.getElementById('waistSeam');
                this.hemInput = document.getElementById('hem');
                
                this.seamsValue = document.getElementById('seamsValue');
                this.sideSeamValue = document.getElementById('sideSeamValue');
                this.lengthValue = document.getElementById('lengthValue');
                this.waistValue = document.getElementById('waistValue');
                this.waistSeamValue = document.getElementById('waistSeamValue');
                this.hemValue = document.getElementById('hemValue');
                
                this.waistRadiusEl = document.getElementById('waistRadius');
                this.totalRadiusEl = document.getElementById('totalRadius');
                this.waistArcEl = document.getElementById('waistArc');
                
                this.resetBtn = document.getElementById('resetBtn');
                this.previewBtn = document.getElementById('previewBtn');
                this.splitAllBtn = document.getElementById('splitAll');
                this.mergeAllBtn = document.getElementById('mergeAll');
                this.resetPanelsBtn = document.getElementById('resetPanels');
                
                this.canvas = document.getElementById('skirtCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.panels = [];
                this.seams = 12;
                this.customPanels = null; // Store custom proportional angles
                
                this.setSkirtType('full');
            }
            
            setSkirtType(type) {
                this.skirtType = type;
                this.customPanels = null; // Reset custom proportions when type changes
                this.skirtTypeBtns.forEach(btn => btn.classList.remove('active'));
                const btn = document.querySelector(`[data-type="${type}"]`);
                if(btn) btn.classList.add('active');
            }
            
            initCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.canvas.addEventListener('mousedown', (e) => this.handleCanvasClick(e));
            }
            
            bindEvents() {
                this.skirtTypeBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setSkirtType(btn.dataset.type);
                        this.calculate();
                    });
                });
                
                [this.sideSeamInput, this.lengthInput, this.waistInput, this.waistSeamInput, this.hemInput].forEach(input => {
                    input.addEventListener('input', () => this.calculate());
                });

                this.seamsInput.addEventListener('input', (e) => {
                    let val = parseInt(e.target.value);
                    if (isNaN(val) || val < 1) val = 1;
                    this.customPanels = null; // Revert to even split if manually changed
                    this.updateSeamCount(val);
                });
                
                this.resetBtn.addEventListener('click', () => this.reset());
                this.previewBtn.addEventListener('click', () => this.preview());
                this.splitAllBtn.addEventListener('click', () => this.splitAllPanels());
                this.mergeAllBtn.addEventListener('click', () => this.mergeAllPanels());
                this.resetPanelsBtn.addEventListener('click', () => this.resetPanels());
                
                window.addEventListener('resize', () => {
                    this.initCanvas();
                    this.calculate();
                });
            }

            updateSeamCount(val) {
                const slider = document.getElementById('seamsSlider');
                if (val > parseInt(slider.max)) {
                    slider.max = val;
                }
                slider.value = val;
                this.seamsInput.value = val;
                this.seamsValue.textContent = val;
                this.seams = val;
                this.calculate();
            }
            
            setupSliders() {
                const sliderPairs = [
                    { input: 'seams', slider: 'seamsSlider', display: 'seamsValue' },
                    { input: 'sideSeam', slider: 'sideSeamSlider', display: 'sideSeamValue' },
                    { input: 'length', slider: 'lengthSlider', display: 'lengthValue' },
                    { input: 'waist', slider: 'waistSlider', display: 'waistValue' },
                    { input: 'waistSeam', slider: 'waistSeamSlider', display: 'waistSeamValue' },
                    { input: 'hem', slider: 'hemSlider', display: 'hemValue' }
                ];
                
                sliderPairs.forEach(pair => {
                    const inputEl = document.getElementById(pair.input);
                    const sliderEl = document.getElementById(pair.slider);
                    const displayEl = document.getElementById(pair.display);
                    
                    sliderEl.addEventListener('input', () => {
                        inputEl.value = sliderEl.value;
                        displayEl.textContent = sliderEl.value;
                        if(pair.input === 'seams') {
                            this.customPanels = null;
                            this.seams = parseInt(sliderEl.value);
                        }
                        this.calculate();
                    });
                });
            }
            
            calculate() {
                const waist = parseFloat(this.waistInput.value) || 38.5;
                const length = parseFloat(this.lengthInput.value) || 22;
                const sideSeam = parseFloat(this.sideSeamInput.value) || 0.375;
                const waistSeam = parseFloat(this.waistSeamInput.value) || 0.375;
                const hem = parseFloat(this.hemInput.value) || 1.5;
                
                let waistRadius;
                const adjustedWaist = waist + (sideSeam * 2);
                
                switch(this.skirtType) {
                    case 'full': waistRadius = adjustedWaist / (2 * Math.PI); break;
                    case 'three-quarter': waistRadius = adjustedWaist / (1.5 * Math.PI); break;
                    case 'half': waistRadius = adjustedWaist / Math.PI; break;
                    case 'third': waistRadius = adjustedWaist / (0.666 * Math.PI); break;
                    case 'quarter': waistRadius = adjustedWaist / (0.5 * Math.PI); break;
                    default: waistRadius = adjustedWaist / Math.PI;
                }
                
                const totalRadius = waistRadius + length + hem;
                const waistArc = waist + (sideSeam * 2) + (waistSeam * this.seams);
                
                this.waistRadiusEl.textContent = waistRadius.toFixed(2) + '"';
                this.totalRadiusEl.textContent = totalRadius.toFixed(2) + '"';
                this.waistArcEl.textContent = waistArc.toFixed(2) + '"';
                
                this.updatePanelsData(waistRadius, totalRadius);
                this.drawSkirt(waistRadius, totalRadius);
            }
            
            updatePanelsData(waistRadius, totalRadius) {
                let totalAngle;
                switch(this.skirtType) {
                    case 'full': totalAngle = 2 * Math.PI; break;
                    case 'three-quarter': totalAngle = 1.5 * Math.PI; break;
                    case 'half': totalAngle = Math.PI; break;
                    case 'third': totalAngle = 0.666 * Math.PI; break;
                    case 'quarter': totalAngle = 0.5 * Math.PI; break;
                    default: totalAngle = Math.PI;
                }

                if (this.customPanels) {
                    this.panels = this.customPanels.map((p, i) => ({
                        id: i + 1,
                        startAngle: p.start,
                        endAngle: p.end,
                        waistRadius,
                        totalRadius
                    }));
                } else {
                    this.panels = [];
                    const angleStep = totalAngle / this.seams;
                    for (let i = 0; i < this.seams; i++) {
                        this.panels.push({
                            id: i + 1,
                            startAngle: i * angleStep,
                            endAngle: (i + 1) * angleStep,
                            waistRadius,
                            totalRadius
                        });
                    }
                }
            }
            
            drawSkirt(waistRadius, totalRadius) {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const maxRadius = Math.max(waistRadius, totalRadius);
                const scale = Math.min(centerX, centerY) * 0.95 / maxRadius;
                
                this.ctx.strokeStyle = '#ddd';
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, waistRadius * scale, 0, Math.PI * 2);
                this.ctx.stroke();
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, totalRadius * scale, 0, Math.PI * 2);
                this.ctx.stroke();
                
                this.panels.forEach(panel => {
                    this.ctx.strokeStyle = '#3498db';
                    this.ctx.lineWidth = 2;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, panel.totalRadius * scale, panel.startAngle, panel.endAngle);
                    this.ctx.stroke();
                    
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, panel.waistRadius * scale, panel.startAngle, panel.endAngle);
                    this.ctx.stroke();
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX + panel.waistRadius * scale * Math.cos(panel.startAngle), centerY + panel.waistRadius * scale * Math.sin(panel.startAngle));
                    this.ctx.lineTo(centerX + panel.totalRadius * scale * Math.cos(panel.startAngle), centerY + panel.totalRadius * scale * Math.sin(panel.startAngle));
                    this.ctx.stroke();
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX + panel.waistRadius * scale * Math.cos(panel.endAngle), centerY + panel.waistRadius * scale * Math.sin(panel.endAngle));
                    this.ctx.lineTo(centerX + panel.totalRadius * scale * Math.cos(panel.endAngle), centerY + panel.totalRadius * scale * Math.sin(panel.endAngle));
                    this.ctx.stroke();
                    
                    const midAngle = (panel.startAngle + panel.endAngle) / 2;
                    const labelRadius = (panel.waistRadius + (panel.totalRadius - panel.waistRadius) / 2) * scale;
                    this.ctx.fillStyle = '#2c3e50';
                    this.ctx.font = 'bold 10px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(`P${panel.id}`, centerX + labelRadius * Math.cos(midAngle), centerY + labelRadius * Math.sin(midAngle));
                });
            }
            
            handleCanvasClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                let angle = Math.atan2(y - centerY, x - centerX);
                if (angle < 0) angle += Math.PI * 2;
                
                const dist = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                const waistRadius = parseFloat(this.waistRadiusEl.textContent);
                const totalRadius = parseFloat(this.totalRadiusEl.textContent);
                const maxRadius = Math.max(waistRadius, totalRadius);
                const scale = Math.min(centerX, centerY) * 0.95 / maxRadius;

                if (dist >= waistRadius * scale * 0.3 && dist <= totalRadius * scale * 1.2) {
                    const idx = this.panels.findIndex(p => {
                        let s = p.startAngle % (Math.PI * 2);
                        let e = p.endAngle % (Math.PI * 2);
                        return s < e ? (angle >= s && angle <= e) : (angle >= s || angle <= e);
                    });

                    if (idx !== -1) {
                        this.splitSinglePanel(idx);
                    }
                }
            }

            splitSinglePanel(index) {
                const target = this.panels[index];
                const mid = (target.startAngle + target.endAngle) / 2;
                
                let newProportions = [];
                this.panels.forEach((p, i) => {
                    if (i === index) {
                        newProportions.push({ start: p.startAngle, end: mid });
                        newProportions.push({ start: mid, end: p.endAngle });
                    } else {
                        newProportions.push({ start: p.startAngle, end: p.endAngle });
                    }
                });

                this.customPanels = newProportions;
                this.updateSeamCount(this.panels.length + 1);
            }
            
            splitAllPanels() {
                this.customPanels = null;
                this.updateSeamCount(this.seams * 2);
            }
            
            mergeAllPanels() {
                this.customPanels = null;
                if (this.seams > 1) {
                    this.updateSeamCount(Math.floor(this.seams / 2) || 1);
                }
            }
            
            resetPanels() {
                this.customPanels = null;
                this.updateSeamCount(12);
            }
            
            reset() {
                this.customPanels = null;
                const defaults = { seams: 12, sideSeam: 0.375, length: 22, waist: 38.5, waistSeam: 0.375, hem: 1.5 };
                Object.entries(defaults).forEach(([k, v]) => {
                    document.getElementById(k).value = v;
                    document.getElementById(k + 'Slider').value = v;
                    document.getElementById(k + 'Value').textContent = v;
                });
                this.seams = 12;
                this.setSkirtType('full');
                this.calculate();
            }
            
            preview() {
                alert('Printing logic would execute here.');
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new CircleSkirtCalculator();
        });
    </script>
</body>
</html>