<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle Skirt Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }
        
        body {
            background: #f0f2f5;
            color: #333;
            padding: 12px;
            min-height: 100vh;
        }
        
        .calculator-container {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 12px;
            align-items: stretch;
        }
        
        .input-section, .visual-section {
            background: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            height: auto;
            display: flex;
            flex-direction: column;
        }
        
        .visual-section {
            align-items: center;
            justify-content: flex-start;
            position: relative;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 18px; 
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            width: 100%;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 8px;
        }
        
        label {
            display: block;
            margin-bottom: 2px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
        }
        
        .input-with-slider {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .number-input {
            width: 100%;
            padding: 3px 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            height: 28px;
        }
        
        .number-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
            height: 40px;
        }

        .dot-selector-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 5px;
        }

        .dot-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            flex: 1;
            -webkit-tap-highlight-color: transparent;
        }

        .dot {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 3px solid #3498db;
            background: white;
            margin-bottom: 6px;
            transition: all 0.2s;
        }

        .dot-option.active .dot {
            background: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.6);
        }

        .dot-label {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            white-space: nowrap;
        }
        
        .slider-value {
            min-width: 28px;
            font-size: 13px;
            color: #666;
            text-align: right;
        }
        
        .range-slider {
            flex: 1;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: #3498db;
            border-radius: 2px;
            outline: none;
            margin: 0;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .range-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .canvas-container {
            width: 100%;
            height: auto;
            flex-grow: 1;
            min-height: 640px; 
            position: relative;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        canvas {
            width: 100%;
            height: 100%;
        }
        
        .panel-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px; 
            width: 100%;
        }
        
        .panel-btn {
            padding: 12px 5px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px; 
            font-weight: 600;
            -webkit-tap-highlight-color: transparent;
        }
        
        .panel-btn:hover { background: #2980b9; }
        .panel-btn.secondary { background: #e67e22; }
        .panel-btn.secondary:hover { background: #d35400; }
        .panel-btn.undo { background: #7f8c8d; }
        .panel-btn.undo:hover { background: #636e72; }
        .panel-btn:disabled { background: #ccc; cursor: not-allowed; }
        
        .results-box {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 12px;
            margin: 12px 0;
        }
        
        .result-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .result-value {
            font-size: 22px; 
            font-weight: 600;
            color: #2c3e50;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 500;
            font-size: 20px; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .reset-btn { background: #95a5a6; color: white; }
        .reset-btn:hover { background: #7f8c8d; }
        .preview-btn { background: #2ecc71; color: white; }
        .preview-btn:hover { background: #27ae60; }
        
        @media (max-width: 768px) {
            .calculator-container { grid-template-columns: 1fr; gap: 8px; }
            .visual-section { margin-bottom: 0; padding-bottom: 12px; }
            .form-row { grid-template-columns: 1fr; }
            .canvas-container { min-height: 400px; }
            .panel-controls { margin-top: 8px; gap: 6px; }
            .panel-btn { font-size: 13px; padding: 14px 4px; }
            .input-section { margin-top: 0; }
            .dot { width: 44px; height: 44px; } /* Slightly larger for mobile tap targets */
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="visual-section">
            <h2>Pattern Preview (Select 1 or 2 panels)</h2>
            <div class="canvas-container" id="container">
                <canvas id="skirtCanvas"></canvas>
            </div>
            <div class="panel-controls">
                <button class="panel-btn secondary" id="splitSingle">Split Selected</button>
                <button class="panel-btn secondary" id="mergeSingle">Merge Selected (2)</button>
                <button class="panel-btn undo" id="undoAction" disabled>Undo Last Action</button>
                <button class="panel-btn" id="splitAll">Split All</button>
                <button class="panel-btn" id="mergeAll">Merge All</button>
                <button class="panel-btn" id="resetPanels">Reset Panels</button>
            </div>
        </div>
        
        <div class="input-section">
            <h2>Skirt Settings</h2>
            
            <div class="form-group">
                <div class="dot-selector-container">
                    <div class="dot-option" data-type="full">
                        <div class="dot"></div>
                        <span class="dot-label">Full</span>
                    </div>
                    <div class="dot-option" data-type="three-quarter">
                        <div class="dot"></div>
                        <span class="dot-label">3/4</span>
                    </div>
                    <div class="dot-option" data-type="half">
                        <div class="dot"></div>
                        <span class="dot-label">Half</span>
                    </div>
                    <div class="dot-option" data-type="third">
                        <div class="dot"></div>
                        <span class="dot-label">1/3</span>
                    </div>
                    <div class="dot-option" data-type="quarter">
                        <div class="dot"></div>
                        <span class="dot-label">1/4</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <div class="form-group">
                        <label>Total Seams:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="seams" value="12" min="1" max="100" step="1">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="seamsSlider" min="1" max="32" step="1" value="12">
                                <span class="slider-value" id="seamsValue">12</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Side Seam:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="sideSeam" value="0.375" min="0" max="2" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="sideSeamSlider" min="0" max="2" step="0.125" value="0.375">
                                <span class="slider-value" id="sideSeamValue">0.375</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Length:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="length" value="22" min="5" max="60" step="0.5">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="lengthSlider" min="5" max="60" step="0.5" value="22">
                                <span class="slider-value" id="lengthValue">22</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="form-group">
                        <label>Waist Circ.:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="waist" value="38.5" min="20" max="60" step="0.5">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="waistSlider" min="20" max="60" step="0.5" value="38.5">
                                <span class="slider-value" id="waistValue">38.5</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Waist Seam:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="waistSeam" value="0.375" min="0" max="2" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="waistSeamSlider" min="0" max="2" step="0.125" value="0.375">
                                <span class="slider-value" id="waistSeamValue">0.375</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Hem Allowance:</label>
                        <div class="input-with-slider">
                            <input type="number" class="number-input" id="hem" value="1.5" min="0" max="3" step="0.125">
                            <div class="slider-container">
                                <input type="range" class="range-slider" id="hemSlider" min="0" max="3" step="0.125" value="1.5">
                                <span class="slider-value" id="hemValue">1.5</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2>Results</h2>
            <div class="results-box">
                <div class="result-item">
                    <div class="result-label">Waist Radius</div>
                    <div class="result-value" id="waistRadius">6.25"</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Total Radius</div>
                    <div class="result-value" id="totalRadius">29.75"</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Total Waist Arc</div>
                    <div class="result-value" id="waistArc">43.75"</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn reset-btn" id="resetBtn">RESET</button>
                <button class="action-btn preview-btn" id="previewBtn">PREVIEW / PRINT</button>
            </div>
        </div>
    </div>

    <script>
        class CircleSkirtCalculator {
            constructor() {
                this.history = [];
                this.selectedIndex = null;
                this.secondSelectedIndex = null;
                this.initElements();
                this.initCanvas();
                this.bindEvents();
                this.setupSliders();
                this.calculate();
            }
            
            initElements() {
                this.dotOptions = document.querySelectorAll('.dot-option');
                this.skirtType = 'full';
                
                this.seamsInput = document.getElementById('seams');
                this.sideSeamInput = document.getElementById('sideSeam');
                this.lengthInput = document.getElementById('length');
                this.waistInput = document.getElementById('waist');
                this.waistSeamInput = document.getElementById('waistSeam');
                this.hemInput = document.getElementById('hem');
                
                this.seamsValue = document.getElementById('seamsValue');
                this.sideSeamValue = document.getElementById('sideSeamValue');
                this.lengthValue = document.getElementById('lengthValue');
                this.waistValue = document.getElementById('waistValue');
                this.waistSeamValue = document.getElementById('waistSeamValue');
                this.hemValue = document.getElementById('hemValue');
                
                this.waistRadiusEl = document.getElementById('waistRadius');
                this.totalRadiusEl = document.getElementById('totalRadius');
                this.waistArcEl = document.getElementById('waistArc');
                
                this.resetBtn = document.getElementById('resetBtn');
                this.undoBtn = document.getElementById('undoAction');
                
                this.canvas = document.getElementById('skirtCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.panels = [];
                this.seams = 12;
                this.customPanels = null; 
                
                this.setSkirtType('full');
            }
            
            setSkirtType(type) {
                this.skirtType = type;
                this.customPanels = null;
                this.dotOptions.forEach(opt => {
                    opt.classList.toggle('active', opt.dataset.type === type);
                });
            }
            
            initCanvas() {
                const rect = this.canvas.parentNode.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
            }

            saveState() {
                const state = {
                    customPanels: this.customPanels ? JSON.parse(JSON.stringify(this.customPanels)) : null,
                    seams: this.seams,
                    skirtType: this.skirtType
                };
                this.history.push(state);
                this.updateUndoButton();
            }

            undo() {
                if (this.history.length > 0) {
                    const lastState = this.history.pop();
                    this.customPanels = lastState.customPanels;
                    this.seams = lastState.seams;
                    this.skirtType = lastState.skirtType;
                    
                    this.seamsInput.value = this.seams;
                    this.seamsValue.textContent = this.seams;
                    document.getElementById('seamsSlider').value = this.seams;
                    
                    this.setSkirtType(this.skirtType);
                    this.selectedIndex = null;
                    this.secondSelectedIndex = null;
                    this.calculate();
                    this.updateUndoButton();
                }
            }

            updateUndoButton() {
                this.undoBtn.disabled = this.history.length === 0;
            }

            splitSinglePanel(index) {
                const target = this.panels[index];
                const mid = (target.startAngle + target.endAngle) / 2;
                let newProportions = [];
                this.panels.forEach((p, i) => {
                    if (i === index) {
                        newProportions.push({ start: p.startAngle, end: mid });
                        newProportions.push({ start: mid, end: p.endAngle });
                    } else newProportions.push({ start: p.startAngle, end: p.endAngle });
                });
                this.customPanels = newProportions;
                this.updateSeamCount(newProportions.length);
                this.selectedIndex = null;
                this.secondSelectedIndex = null;
            }

            mergeTwoPanels(idx1, idx2) {
                if (this.panels.length <= 1) return;
                const first = Math.min(idx1, idx2);
                const last = Math.max(idx1, idx2);
                const isAdjacent = (last === first + 1);
                const isWrap = (first === 0 && last === this.panels.length - 1);

                if (!isAdjacent && !isWrap) {
                    alert("Only adjacent panels can be merged.");
                    return;
                }

                let newProportions = [];
                if (isWrap) {
                    newProportions.push({ start: this.panels[last].startAngle, end: this.panels[first].endAngle });
                    for(let i = 1; i < last; i++) {
                        newProportions.push({ start: this.panels[i].startAngle, end: this.panels[i].endAngle });
                    }
                } else {
                    for(let i = 0; i < this.panels.length; i++) {
                        if (i === first) {
                            newProportions.push({ start: this.panels[first].startAngle, end: this.panels[last].endAngle });
                            i++; 
                        } else {
                            newProportions.push({ start: this.panels[i].startAngle, end: this.panels[i].endAngle });
                        }
                    }
                }
                this.customPanels = newProportions;
                this.updateSeamCount(newProportions.length);
                this.selectedIndex = null;
                this.secondSelectedIndex = null;
            }

            splitAllPanels() {
                this.customPanels = null;
                this.updateSeamCount(this.seams * 2);
            }

            mergeAllPanels() {
                this.customPanels = null;
                if (this.seams > 1) this.updateSeamCount(Math.floor(this.seams / 2) || 1);
            }

            resetPanels() {
                this.customPanels = null;
                this.updateSeamCount(12);
            }

            bindEvents() {
                this.dotOptions.forEach(opt => {
                    opt.addEventListener('click', () => {
                        this.saveState();
                        this.setSkirtType(opt.dataset.type);
                        this.calculate();
                    });
                });
                
                [this.sideSeamInput, this.lengthInput, this.waistInput, this.waistSeamInput, this.hemInput].forEach(input => {
                    input.addEventListener('input', () => this.calculate());
                });

                this.seamsInput.addEventListener('input', (e) => {
                    let val = parseInt(e.target.value);
                    if (isNaN(val) || val < 1) val = 1;
                    this.customPanels = null;
                    this.updateSeamCount(val);
                });
                
                this.resetBtn.addEventListener('click', () => this.reset());
                this.undoBtn.addEventListener('click', () => this.undo());

                document.getElementById('splitAll').addEventListener('click', () => {
                    this.saveState();
                    this.splitAllPanels();
                });
                document.getElementById('mergeAll').addEventListener('click', () => {
                    this.saveState();
                    this.mergeAllPanels();
                });
                document.getElementById('resetPanels').addEventListener('click', () => {
                    this.saveState();
                    this.resetPanels();
                });
                document.getElementById('splitSingle').addEventListener('click', () => {
                    if (this.selectedIndex !== null) {
                        this.saveState();
                        this.splitSinglePanel(this.selectedIndex);
                    } else alert("Please click a panel on the preview first.");
                });
                document.getElementById('mergeSingle').addEventListener('click', () => {
                    if (this.selectedIndex !== null && this.secondSelectedIndex !== null) {
                        this.saveState();
                        this.mergeTwoPanels(this.selectedIndex, this.secondSelectedIndex);
                    } else {
                        alert("Please select exactly TWO adjacent panels to merge.");
                    }
                });
                
                // Add touch support for mobile
                this.canvas.addEventListener('mousedown', (e) => this.handleCanvasClick(e));
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.handleCanvasClick(touch);
                }, { passive: false });

                window.addEventListener('resize', () => {
                    this.initCanvas();
                    this.calculate();
                });
            }

            handleCanvasClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                const dx = x - centerX;
                const dy = y - centerY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                let angle = Math.atan2(dy, dx);
                if (angle < 0) angle += 2 * Math.PI;

                const waist = parseFloat(this.waistInput.value);
                const sideSeam = parseFloat(this.sideSeamInput.value);
                const adjustedWaist = waist + (sideSeam * 2);
                let waistRadius;
                switch(this.skirtType) {
                    case 'full': waistRadius = adjustedWaist / (2 * Math.PI); break;
                    case 'three-quarter': waistRadius = adjustedWaist / (1.5 * Math.PI); break;
                    case 'half': waistRadius = adjustedWaist / Math.PI; break;
                    case 'third': waistRadius = adjustedWaist / (0.666 * Math.PI); break;
                    case 'quarter': waistRadius = adjustedWaist / (0.5 * Math.PI); break;
                }
                const totalRadius = waistRadius + parseFloat(this.lengthInput.value) + parseFloat(this.hemInput.value);
                
                const scale = Math.min(centerX, centerY) * 0.95 / totalRadius;

                if (dist >= waistRadius * scale && dist <= totalRadius * scale) {
                    const clickedIdx = this.panels.findIndex(p => {
                        let start = p.startAngle;
                        let end = p.endAngle;
                        if (start > end) return angle >= start || angle <= end;
                        return angle >= start && angle <= end;
                    });
                    
                    if (clickedIdx !== -1) {
                        if (this.selectedIndex === clickedIdx) {
                            this.selectedIndex = this.secondSelectedIndex;
                            this.secondSelectedIndex = null;
                        } else if (this.secondSelectedIndex === clickedIdx) {
                            this.secondSelectedIndex = null;
                        } else {
                            this.secondSelectedIndex = this.selectedIndex;
                            this.selectedIndex = clickedIdx;
                        }
                        this.calculate();
                    }
                }
            }

            updateSeamCount(val) {
                const slider = document.getElementById('seamsSlider');
                if (val > parseInt(slider.max)) slider.max = val;
                slider.value = val;
                this.seamsInput.value = val;
                this.seamsValue.textContent = val;
                this.seams = val;
                this.calculate();
            }
            
            setupSliders() {
                const sliderPairs = [
                    { input: 'seams', slider: 'seamsSlider', display: 'seamsValue' },
                    { input: 'sideSeam', slider: 'sideSeamSlider', display: 'sideSeamValue' },
                    { input: 'length', slider: 'lengthSlider', display: 'lengthValue' },
                    { input: 'waist', slider: 'waistSlider', display: 'waistValue' },
                    { input: 'waistSeam', slider: 'waistSeamSlider', display: 'waistSeamValue' },
                    { input: 'hem', slider: 'hemSlider', display: 'hemValue' }
                ];
                
                sliderPairs.forEach(pair => {
                    const inputEl = document.getElementById(pair.input);
                    const sliderEl = document.getElementById(pair.slider);
                    const displayEl = document.getElementById(pair.display);
                    
                    sliderEl.addEventListener('input', () => {
                        if(pair.input === 'seams') this.saveState();
                        inputEl.value = sliderEl.value;
                        displayEl.textContent = sliderEl.value;
                        if(pair.input === 'seams') {
                            this.customPanels = null;
                            this.seams = parseInt(sliderEl.value);
                        }
                        this.calculate();
                    });
                });
            }
            
            calculate() {
                const waist = parseFloat(this.waistInput.value) || 38.5;
                const length = parseFloat(this.lengthInput.value) || 22;
                const sideSeam = parseFloat(this.sideSeamInput.value) || 0.375;
                const waistSeam = parseFloat(this.waistSeamInput.value) || 0.375;
                const hem = parseFloat(this.hemInput.value) || 1.5;
                
                let waistRadius;
                const adjustedWaist = waist + (sideSeam * 2);
                
                switch(this.skirtType) {
                    case 'full': waistRadius = adjustedWaist / (2 * Math.PI); break;
                    case 'three-quarter': waistRadius = adjustedWaist / (1.5 * Math.PI); break;
                    case 'half': waistRadius = adjustedWaist / Math.PI; break;
                    case 'third': waistRadius = adjustedWaist / (0.666 * Math.PI); break;
                    case 'quarter': waistRadius = adjustedWaist / (0.5 * Math.PI); break;
                    default: waistRadius = adjustedWaist / Math.PI;
                }
                
                const totalRadius = waistRadius + length + hem;
                const waistArc = waist + (sideSeam * 2) + (waistSeam * this.seams);
                
                this.waistRadiusEl.textContent = waistRadius.toFixed(2) + '"';
                this.totalRadiusEl.textContent = totalRadius.toFixed(2) + '"';
                this.waistArcEl.textContent = waistArc.toFixed(2) + '"';
                
                this.updatePanelsData(waistRadius, totalRadius);
                this.drawSkirt(waistRadius, totalRadius);
            }
            
            updatePanelsData(waistRadius, totalRadius) {
                let totalAngle;
                switch(this.skirtType) {
                    case 'full': totalAngle = 2 * Math.PI; break;
                    case 'three-quarter': totalAngle = 1.5 * Math.PI; break;
                    case 'half': totalAngle = Math.PI; break;
                    case 'third': totalAngle = 0.666 * Math.PI; break;
                    case 'quarter': totalAngle = 0.5 * Math.PI; break;
                    default: totalAngle = Math.PI;
                }

                if (this.customPanels) {
                    this.panels = this.customPanels.map((p, i) => ({
                        id: i + 1,
                        startAngle: p.start,
                        endAngle: p.end,
                        waistRadius,
                        totalRadius
                    }));
                } else {
                    this.panels = [];
                    const angleStep = totalAngle / this.seams;
                    for(let i = 0; i < this.seams; i++) {
                        this.panels.push({
                            id: i + 1,
                            startAngle: i * angleStep,
                            endAngle: (i + 1) * angleStep,
                            waistRadius,
                            totalRadius
                        });
                    }
                }
            }

            drawSkirt(waistRadius, totalRadius) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const scale = Math.min(centerX, centerY) * 0.95 / totalRadius;
                
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.panels.forEach((panel, index) => {
                    const isSelected = index === this.selectedIndex || index === this.secondSelectedIndex;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, totalRadius * scale, panel.startAngle, panel.endAngle);
                    this.ctx.arc(centerX, centerY, waistRadius * scale, panel.endAngle, panel.startAngle, true);
                    this.ctx.closePath();
                    
                    this.ctx.fillStyle = isSelected ? '#3498db' : '#ecf0f1';
                    this.ctx.fill();
                    this.ctx.strokeStyle = isSelected ? '#2980b9' : '#bdc3c7';
                    this.ctx.lineWidth = isSelected ? 3 : 1;
                    this.ctx.stroke();

                    // Text labels
                    const midAngle = (panel.startAngle + (panel.startAngle > panel.endAngle ? panel.endAngle + 2*Math.PI : panel.endAngle)) / 2;
                    const textRadius = (waistRadius + totalRadius) / 2 * scale;
                    this.ctx.save();
                    this.ctx.translate(centerX + Math.cos(midAngle) * textRadius, centerY + Math.sin(midAngle) * textRadius);
                    this.ctx.fillStyle = isSelected ? 'white' : '#7f8c8d';
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(panel.id, 0, 5);
                    this.ctx.restore();
                });
            }

            reset() {
                this.saveState();
                this.setSkirtType('full');
                this.seams = 12;
                this.seamsInput.value = 12;
                this.seamsValue.textContent = 12;
                document.getElementById('seamsSlider').value = 12;
                this.sideSeamInput.value = 0.375;
                this.lengthInput.value = 22;
                this.waistInput.value = 38.5;
                this.waistSeamInput.value = 0.375;
                this.hemInput.value = 1.5;
                this.customPanels = null;
                this.selectedIndex = null;
                this.secondSelectedIndex = null;
                
                const sliderPairs = ['sideSeam', 'length', 'waist', 'waistSeam', 'hem'];
                sliderPairs.forEach(id => {
                    const input = document.getElementById(id);
                    const slider = document.getElementById(id + 'Slider');
                    const display = document.getElementById(id + 'Value');
                    slider.value = input.value;
                    display.textContent = input.value;
                });
                
                this.calculate();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.app = new CircleSkirtCalculator();
        });
    </script>
</body>
</html>
